# 需求分析

## 1. 用户画像

### 1.1 目标用户

本项目主要面向四类用户：

#### 游客（Visitor）

| 属性 | 描述 |
|-----|------|
| 身份 | 未注册的访问者 |
| 权限 | 浏览笔记、查看课程列表 |
| 限制 | 在线IP超50需排队，下载需注册 |
| 行为特征 | 通过搜索引擎或社交媒体链接进入 |

#### 注册用户（User）

| 属性 | 描述 |
|-----|------|
| 身份 | 通过手机号注册的用户 |
| 权限 | 游客权限 + 付费下载 + 个人中心 |
| 限制 | 15秒访问频率限制 |
| 用户名 | 自动生成：日期+手机号后4位（如202601156826） |

#### 会员（VIP）

| 属性 | 描述 |
|-----|------|
| 身份 | 年消费满2000元的用户（不含邀请码） |
| 权限 | 用户权限 + 全站视频下载 |
| 有效期 | 从达标时刻起1自然年 |
| 特殊待遇 | 全站公告滚动3天 |

#### 站长/管理员（Admin）

| 属性 | 描述 |
|-----|------|
| 身份 | 网站运营者（即你本人） |
| 权限 | 内容管理、订单管理、邀请码管理、系统配置 |

### 1.2 用户场景

```
场景1：游客浏览笔记
小明通过搜索找到网站，浏览学习笔记，想要下载时被提示需要注册

场景2：用户注册
小明输入手机号，收到验证码，完成注册，用户名自动生成为202601156826

场景3：用户购买课程
小明选择感兴趣的课程，通过第三方支付或邀请码完成购买，获得下载权限

场景4：用户查看记录
小明在个人中心查看自己的订单记录、浏览历史、下载记录

场景5：用户成为会员
小明年消费累计达到2000元，自动升级为会员，全站公告滚动展示3天

场景6：站长管理
站长生成邀请码发给特定用户，查看订单记录，更新课程内容
```

## 2. 功能需求

### 2.1 功能全景图

```
┌──────────────────────────────────────────────────────────────────────────┐
│                              HPA 私域网站                                 │
├────────────────┬────────────────┬────────────────┬───────────────────────┤
│    内容展示     │    用户系统     │    交易系统     │      系统管理         │
├────────────────┼────────────────┼────────────────┼───────────────────────┤
│ • 首页展示     │ • 手机号注册    │ • 课程列表     │ • 邀请码管理          │
│ • 笔记分类     │ • 验证码登录    │ • 课程详情     │ • 订单管理            │
│ • 笔记详情     │ • 个人中心      │ • 多种排序     │ • 内容管理            │
│ • 公告滚动     │ • 浏览记录      │ • 第三方支付   │ • 访问统计            │
│               │ • 下载记录      │ • 邀请码兑换   │ • 安全防护            │
│               │ • 订单记录      │ • 会员体系     │                       │
└────────────────┴────────────────┴────────────────┴───────────────────────┘
```

### 2.2 MVP 功能清单

#### P0 - 必须实现（核心功能）

| 编号 | 功能 | 描述 | 验收标准 |
|-----|------|------|---------|
| F001 | 首页展示 | 网站首页，展示最新笔记、热门课程、公告 | 页面正常加载，公告滚动正常 |
| F002 | 笔记列表 | 按分类展示所有笔记 | 支持分类筛选，分页展示 |
| F003 | 笔记详情 | 展示单篇笔记内容 | Markdown 正确渲染，代码高亮 |
| F004 | 手机注册 | 手机号+验证码注册 | 用户名自动生成，验证码5分钟有效 |
| F005 | 用户登录 | 手机号+验证码登录 | 登录成功返回Token |
| F006 | 课程列表 | 展示所有付费课程 | 支持按点击量/下载量/更新时间排序 |
| F007 | 课程详情 | 展示课程详细介绍 | 包含课程大纲、价格、购买按钮 |
| F008 | 第三方支付 | 调用支付接口（预留） | 接口预留，具体实现后补 |
| F009 | 邀请码兑换 | 使用邀请码获取课程 | 一次性使用，不计入年消费 |
| F010 | 课程下载 | 提供课程下载链接 | 链接有效，下载正常 |
| F011 | 个人中心 | 用户信息展示 | 显示用户名、会员状态、消费金额 |
| F012 | 订单记录 | 查看个人订单 | 列表展示，包含课程、金额、时间 |
| F013 | 浏览记录 | 查看浏览历史 | 记录浏览的笔记和课程 |
| F014 | 下载记录 | 查看下载历史 | 记录下载的课程和时间 |
| F015 | 访问频率限制 | 用户级15秒限制 | 超频返回错误提示 |
| F016 | 游客排队 | IP超50排队 | 显示排队位置和预计等待时间 |

#### P1 - 应该实现（增强功能）

| 编号 | 功能 | 描述 | 验收标准 |
|-----|------|------|---------|
| F017 | 会员升级 | 年消费满2000元自动升级 | 触发条件准确，权限即时生效 |
| F018 | 会员公告 | 新会员公告滚动3天 | 首页滚动展示 |
| F019 | 邀请码管理 | 站长生成和管理邀请码 | 可查看生成记录和使用记录 |
| F020 | 订单管理 | 站长查看所有订单 | 支持筛选、导出 |
| F021 | 访问统计 | 记录页面访问量 | PV/UV 统计准确 |

#### P2 - 可以实现（未来功能）

| 编号 | 功能 | 描述 |
|-----|------|------|
| F022 | 全文搜索 | 笔记内容搜索 |
| F023 | 邮件通知 | 订单邮件通知 |
| F024 | 数据导出 | 访问数据导出 |
| F025 | 会员续费 | 会员到期续费提醒 |

### 2.3 用户故事

#### 游客用户故事

```gherkin
US-001: 浏览学习笔记
作为 游客
我想要 浏览网站上的学习笔记
以便于 获取所需的技术知识

验收条件：
- 可以查看笔记分类列表
- 可以点击进入笔记详情
- 笔记内容格式正确展示
- 在线IP超50时显示排队页面
```

```gherkin
US-002: 注册成为用户
作为 游客
我想要 通过手机号快速注册
以便于 下载课程内容

验收条件：
- 输入手机号后可获取验证码
- 验证码5分钟内有效
- 注册成功后用户名自动生成（如202601156826）
- 注册成功后自动登录
```

#### 注册用户故事

```gherkin
US-003: 购买视频课程
作为 注册用户
我想要 购买感兴趣的视频课程
以便于 系统地学习某项技能

验收条件：
- 可以查看课程介绍和价格
- 可以选择支付方式（第三方支付或邀请码）
- 支付成功后获取下载链接
- 订单记录在个人中心可查
```

```gherkin
US-004: 查看个人记录
作为 注册用户
我想要 查看我的订单、浏览、下载记录
以便于 了解我的学习轨迹

验收条件：
- 可以查看所有订单列表
- 可以查看浏览过的笔记和课程
- 可以查看下载过的课程
- 记录按时间倒序排列
```

```gherkin
US-005: 课程排序
作为 注册用户
我想要 按不同方式排序课程列表
以便于 找到最适合我的课程

验收条件：
- 默认按站长上传顺序排序
- 可以切换为按点击量排序
- 可以切换为按下载量排序
- 可以切换为按更新时间排序
```

#### 站长用户故事

```gherkin
US-006: 生成邀请码
作为 站长
我想要 生成邀请码发给特定用户
以便于 进行课程赠送或推广

验收条件：
- 可以选择课程生成邀请码
- 邀请码为一次性使用
- 可以查看邀请码生成记录
- 可以查看邀请码使用记录
```

```gherkin
US-007: 管理订单
作为 站长
我想要 查看和管理所有订单
以便于 了解销售情况

验收条件：
- 可以查看所有订单列表
- 订单包含用户、课程、金额、时间、支付方式
- 可以区分真实支付和邀请码兑换
```

## 3. 非功能需求

### 3.1 性能需求

| 指标 | 要求 | 说明 |
|-----|------|------|
| 页面加载 | < 2 秒 | 首屏加载时间 |
| API 响应 | < 500ms | 接口响应时间 |
| 并发用户 | 50+ | 注册用户同时在线数 |
| 游客上限 | 50 IP | 超过后排队 |
| 下载速度 | 取决于带宽 | 建议 10Mbps+ |

### 3.2 安全需求

| 需求 | 描述 | 措施 |
|-----|------|------|
| 访问频率限制 | 防止接口滥用和DDoS | 用户级15秒限制 |
| 游客排队 | 防止游客DDoS | IP超50排队 |
| 验证码防刷 | 防止短信轰炸 | 同号60秒间隔，每日上限 |
| 下载链接保护 | 防止链接被分享滥用 | 链接有效期 + 下载次数限制 |
| XSS 防护 | 防止脚本注入 | 内容过滤、CSP 策略 |
| SQL 注入防护 | 防止数据库攻击 | 参数化查询 |

### 3.3 可用性需求

| 需求 | 描述 |
|-----|------|
| 响应式设计 | 支持桌面和移动端访问 |
| 加载提示 | 长操作有加载状态提示 |
| 错误提示 | 操作失败有明确提示 |
| 排队提示 | 显示排队位置和预计时间 |

### 3.4 运维需求

| 需求 | 描述 |
|-----|------|
| 容器化部署 | Docker 单容器部署 |
| 自动重启 | 异常退出自动恢复 |
| 日志记录 | 访问日志、错误日志、安全日志 |
| 数据备份 | SQLite 定期备份 |

## 4. 页面原型

### 4.1 页面清单

| 页面 | 路由 | 说明 | 访问权限 |
|-----|------|------|---------|
| 首页 | `/` | 最新内容、公告滚动 | 所有 |
| 排队页 | `/queue` | 游客排队等待 | 游客 |
| 笔记列表 | `/notes` | 笔记分类和列表 | 所有 |
| 笔记详情 | `/notes/:slug` | 单篇笔记内容 | 所有 |
| 课程列表 | `/courses` | 付费课程列表 | 所有 |
| 课程详情 | `/courses/:slug` | 课程介绍和购买 | 所有 |
| 注册/登录 | `/auth` | 手机号验证码 | 游客 |
| 支付页面 | `/pay/:courseId` | 支付方式选择 | 用户 |
| 下载页面 | `/download/:token` | 课程下载 | 用户 |
| 个人中心 | `/user` | 用户信息 | 用户 |
| 订单记录 | `/user/orders` | 订单列表 | 用户 |
| 浏览记录 | `/user/history` | 浏览历史 | 用户 |
| 下载记录 | `/user/downloads` | 下载历史 | 用户 |
| 关于页面 | `/about` | 站长介绍、联系方式 | 所有 |

### 4.2 页面布局草图

```
┌─────────────────────────────────────────────────────────────┐
│  Logo      [笔记] [课程] [关于]    [登录/用户名]             │  ← 导航栏
├─────────────────────────────────────────────────────────────┤
│  🎉 恭喜用户 202601156826 成为年度会员！                     │  ← 公告滚动
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                   欢迎来到 XXX 学习站                        │  ← Banner
│                                                             │
├───────────────────────────┬─────────────────────────────────┤
│                           │                                 │
│    最新笔记                │    热门课程                     │
│    ├── 笔记1              │    [默认▼] [点击量] [下载量]    │  ← 排序
│    ├── 笔记2              │    ├── 课程1 ¥99               │
│    └── 笔记3              │    └── 课程2 ¥199              │
│                           │                                 │
├─────────────────────────────────────────────────────────────┤
│                © 2025 XXX | 联系方式                         │  ← 页脚
└─────────────────────────────────────────────────────────────┘
```

## 5. 业务流程

### 5.1 用户注册流程

```
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ 输入手机 │───→│ 获取验证码│───→│ 输入验证码│───→│ 注册成功 │
└─────────┘    └─────────┘    └─────────┘    └─────────┘
                   │                              │
                   ↓                              ↓
              60秒间隔限制                  用户名自动生成
              每日上限限制                  如: 202601156826
```

### 5.2 课程购买流程

```
┌─────────┐    ┌─────────┐    ┌─────────────┐    ┌─────────┐
│ 浏览课程 │───→│ 查看详情 │───→│ 选择支付方式 │───→│ 下载课程 │
└─────────┘    └─────────┘    └──────┬──────┘    └─────────┘
                                     │
                    ┌────────────────┼────────────────┐
                    ↓                                 ↓
             ┌─────────────┐                  ┌─────────────┐
             │ 第三方支付   │                  │  邀请码兑换  │
             │ （预留接口） │                  │ （不计年消费）│
             └─────────────┘                  └─────────────┘
```

### 5.3 会员升级流程

```
用户年消费累计
      │
      ↓
  >=2000元？ ──否──→ 继续累计
      │
     是
      ↓
  邀请码消费？──是──→ 不计入，继续累计
      │
     否
      ↓
┌─────────────┐
│ 升级为会员   │
│ 有效期1年    │
│ 全站下载权限 │
└──────┬──────┘
       ↓
┌─────────────┐
│ 全站公告    │
│ 滚动3天     │
└─────────────┘
```

### 5.4 游客排队流程

```
游客访问
    │
    ↓
在线IP数 >=50？ ──否──→ 正常访问
    │
   是
    ↓
┌─────────────┐
│ 进入排队页面 │
│ 显示排队位置 │
│ 预计等待时间 │
└──────┬──────┘
       │
       ↓
  前方IP离开
       │
       ↓
  排队位置更新
       │
       ↓
  排到后进入网站
```

## 6. 数据字典

### 6.1 核心实体

| 实体 | 说明 | 主要属性 |
|-----|------|---------|
| User | 注册用户 | 用户名、手机号、角色、会员到期时间、年消费金额 |
| Note | 学习笔记 | 标题、分类、内容路径、浏览次数 |
| Category | 笔记分类 | 名称、描述、排序 |
| Course | 付费课程 | 名称、价格、简介、文件路径、点击量、下载量 |
| Order | 订单记录 | 用户ID、课程ID、金额、支付方式、状态 |
| InviteCode | 邀请码 | 码值、课程ID、生成时间、使用者、使用时间 |
| BrowseHistory | 浏览记录 | 用户ID、内容类型、内容ID、浏览时间 |
| DownloadHistory | 下载记录 | 用户ID、课程ID、下载时间 |
| Announcement | 公告 | 内容、类型、开始时间、结束时间 |

---

**文档版本**：v2.0
**创建日期**：2025-01-15
**最后更新**：2025-01-15
