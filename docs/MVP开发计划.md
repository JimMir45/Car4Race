# Car4Race MVP 开发计划

> 最后更新：2025-01-17

## 项目概览

| 项目 | 数据库表 | API接口 | 复杂度 |
|------|---------|---------|--------|
| 私域视频网站 | ~10张 | ~20个 | 中等 |
| 圈速榜 | 18张 | 50+个 | 较高 |

**共用部分**：用户认证、技术栈、部署架构

**技术栈**：
- 后端：Go + Gin + GORM
- 数据库：SQLite
- 前端：Vue 3 + Vite + TailwindCSS
- 部署：Docker + Nginx

---

## 第一阶段：基础架构搭建

### 1.1 项目脚手架
- [ ] 初始化 Go 后端项目结构（cmd/internal/pkg）
- [ ] 初始化 Vue 3 + Vite 前端项目
- [ ] 配置 TailwindCSS
- [ ] Docker + Nginx 部署配置
- [ ] SQLite 数据库连接

### 1.2 共用用户系统
- [ ] 用户表设计（User）
- [ ] 手机号 + 验证码注册/登录
- [ ] JWT 认证中间件
- [ ] 短信服务集成（阿里云/腾讯云）

---

## 第二阶段：私域视频网站 MVP

### 2.1 内容展示模块
- [ ] 分类表（categories）
- [ ] 笔记表（notes）
- [ ] 笔记列表 API（GET /notes）
- [ ] 笔记详情 API（GET /notes/:slug）
- [ ] Markdown 渲染（前端）
- [ ] 浏览记录表（browse_history）

### 2.2 课程与订单模块
- [ ] 课程表（courses）
- [ ] 订单表（orders）
- [ ] 课程列表 API（支持4种排序）
- [ ] 课程详情 API
- [ ] 订单创建 API
- [ ] 邀请码表（invite_codes）
- [ ] 邀请码兑换 API

### 2.3 下载与会员模块
- [ ] 下载令牌表（download_tokens）
- [ ] 下载记录表（download_history）
- [ ] 下载验证 API（24小时/3次限制）
- [ ] 会员升级逻辑（年消费≥2000）
- [ ] 会员公告滚动（3天）

### 2.4 安全防护
- [ ] 用户级频率限制（15秒）
- [ ] 游客 IP 排队（>50人）
- [ ] 输入验证中间件

### 2.5 管理后台
- [ ] 邀请码管理
- [ ] 课程管理
- [ ] 公告管理

---

## 第三阶段：圈速榜 MVP

### 3.1 场地模块
- [ ] 赛道表（lt_track）
- [ ] 山路表（lt_mountain）
- [ ] 赛道列表/详情 API
- [ ] 山路标记 API（GPS起终点）
- [ ] 山路重叠检测 API
- [ ] 高德地图集成（前端）

### 3.2 成绩记录模块
- [ ] 成绩记录表（lt_record）
- [ ] 创建成绩 API
- [ ] 我的成绩列表 API
- [ ] 我的最佳成绩 API
- [ ] 文件上传 API（计时图片/视频）
- [ ] RaceChrono CSV 导入 API

### 3.3 榜单模块
- [ ] 综合榜单 API（支持来源/车型/改装筛选）
- [ ] 榜单详情 API
- [ ] 成绩来源标识（官方/大V/个人）

### 3.4 投票验证模块
- [ ] 投票会话表（lt_vote_session）
- [ ] 投票记录表（lt_vote）
- [ ] 投票分配表（lt_vote_assignment）
- [ ] 待投票列表 API
- [ ] 提交投票 API
- [ ] 投票结果计算（10人/5票假=作废）

### 3.5 组织模块
- [ ] 组织表（lt_org）
- [ ] 组织成员表（lt_org_member）
- [ ] 加入申请表（lt_org_join_request）
- [ ] 组织成绩表（lt_org_record）
- [ ] 赞助商表（lt_org_sponsor）
- [ ] 组织创建/详情 API
- [ ] 成员管理 API
- [ ] 组织榜单 API
- [ ] 成绩审核 API

### 3.6 GPS 计时模块
- [ ] 免责声明表（lt_disclaimer_agreement）
- [ ] 免责声明同意 API
- [ ] GPS 计时逻辑（起终点触发）
- [ ] WebSocket 实时推送（可选）

### 3.7 申诉模块
- [ ] 成绩申诉表（lt_record_appeal）
- [ ] 山路申诉表（lt_mountain_appeal）
- [ ] 申诉创建/查询 API

### 3.8 爬虫模块（P2 优先级）
- [ ] 爬虫日志表（lt_crawler_log）
- [ ] 爬取成绩表（lt_crawled_record）
- [ ] 51GT3 爬虫
- [ ] 键盘车神教爬虫
- [ ] 定时任务（每日凌晨5点）

---

## 第四阶段：测试与上线

### 4.1 测试
- [ ] 单元测试
- [ ] API 接口测试
- [ ] 前端功能测试
- [ ] 安全测试

### 4.2 部署上线
- [ ] 生产环境配置
- [ ] HTTPS 证书
- [ ] 域名配置
- [ ] 监控告警

---

## 开发顺序建议

```
阶段1: 基础架构 → 阶段2: 私域视频网站 → 阶段3: 圈速榜 → 阶段4: 测试上线
   ↓                    ↓                    ↓
 共用用户系统        功能相对简单          功能复杂
 技术栈搭建          先上线验证            逐步迭代
```

**理由**：
1. 私域视频网站功能更简单，可以快速上线验证技术栈
2. 用户系统共用，先完成后两个项目复用
3. 圈速榜功能多，建议分批次迭代

---

## 关键数字指标

### 私域视频网站
- 数据库表：~10张
- API接口：~20个
- 用户角色：4种（游客、注册用户、VIP、管理员）

### 圈速榜
- 数据库表：18张
- API接口：50+个
- 用户角色：5种（游客、注册用户、组织成员、组织管理员、系统管理员）
- 成绩来源：3类（官方、大V、个人）
