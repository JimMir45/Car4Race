# Car4Race MVP 开发计划

> 最后更新：2026-01-17

## 项目概览

| 项目 | 数据库表 | API接口 | 复杂度 | 状态 |
|------|---------|---------|--------|------|
| 私域视频网站 | ~10张 | ~20个 | 中等 | 🟡 开发中 |
| 圈速榜 | 18张 | 50+个 | 较高 | ⚪ 待开始 |

**共用部分**：用户认证、技术栈、部署架构

**技术栈**：
- 后端：Go 1.25 + Gin + GORM
- 数据库：SQLite
- 前端：Vue 3 + Vite + TailwindCSS
- 部署：Docker + Nginx

---

## 🎯 MVP 上线前待完成事项

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 短信验证码接入 | 接入阿里云/腾讯云短信服务，替换开发模式 | P0 |
| 支付功能 | 微信/支付宝支付，订单状态回调 | P0 |

---

## 第一阶段：基础架构搭建 ✅

### 1.1 项目脚手架
- [x] 初始化 Go 后端项目结构（cmd/internal/pkg）
- [x] 初始化 Vue 3 + Vite 前端项目
- [x] 配置 TailwindCSS
- [x] Docker + Nginx 部署配置
- [x] SQLite 数据库连接

### 1.2 共用用户系统
- [x] 用户表设计（User）
- [x] 手机号 + 验证码注册/登录
- [x] JWT 认证中间件
- [ ] 短信服务集成（阿里云/腾讯云）— **待接入真实服务**

---

## 第二阶段：私域视频网站 MVP 🟡

### 2.1 内容展示模块
- [x] 分类表（categories）
- [x] 笔记表（notes）
- [x] 笔记列表 API（GET /notes）
- [x] 笔记详情 API（GET /notes/:slug）
- [x] Markdown 渲染（前端）
- [x] 浏览记录表（browse_history）

### 2.2 课程与订单模块
- [x] 课程表（courses）
- [x] 课程文件表（course_files）— 支持 MD 介绍和 ZIP 资源
- [x] 订单表（orders）
- [x] 课程列表 API（支持4种排序）
- [x] 课程详情 API（含 Markdown 内容和资源文件）
- [x] 订单创建 API
- [x] 邀请码表（invite_codes）
- [x] 邀请码兑换 API
- [ ] 支付集成（微信/支付宝）— **待接入**

### 2.3 下载与会员模块
- [x] 下载令牌表（download_tokens）
- [x] 下载记录表（download_history）
- [x] 下载验证 API（24小时/3次限制）
- [x] 会员升级逻辑（年消费≥2000）
- [ ] 会员公告滚动（3天）— 可选功能

### 2.4 安全防护
- [x] 用户级频率限制（15秒）
- [ ] 游客 IP 排队（>50人）— 可选功能
- [x] 输入验证中间件

### 2.5 管理后台
- [x] 邀请码管理（创建、列表）
- [x] 课程管理（CRUD、文件上传）
- [ ] 公告管理 — 可选功能

---

## 第三阶段：圈速榜 MVP

### 3.1 场地模块
- [ ] 赛道表（lt_track）
- [ ] 山路表（lt_mountain）
- [ ] 赛道列表/详情 API
- [ ] 山路标记 API（GPS起终点）
- [ ] 山路重叠检测 API
- [ ] 高德地图集成（前端）

### 3.2 成绩记录模块
- [ ] 成绩记录表（lt_record）
- [ ] 创建成绩 API
- [ ] 我的成绩列表 API
- [ ] 我的最佳成绩 API
- [ ] 文件上传 API（计时图片/视频）
- [ ] RaceChrono CSV 导入 API

### 3.3 榜单模块
- [ ] 综合榜单 API（支持来源/车型/改装筛选）
- [ ] 榜单详情 API
- [ ] 成绩来源标识（官方/大V/个人）

### 3.4 投票验证模块
- [ ] 投票会话表（lt_vote_session）
- [ ] 投票记录表（lt_vote）
- [ ] 投票分配表（lt_vote_assignment）
- [ ] 待投票列表 API
- [ ] 提交投票 API
- [ ] 投票结果计算（10人/5票假=作废）

### 3.5 组织模块
- [ ] 组织表（lt_org）
- [ ] 组织成员表（lt_org_member）
- [ ] 加入申请表（lt_org_join_request）
- [ ] 组织成绩表（lt_org_record）
- [ ] 赞助商表（lt_org_sponsor）
- [ ] 组织创建/详情 API
- [ ] 成员管理 API
- [ ] 组织榜单 API
- [ ] 成绩审核 API

### 3.6 GPS 计时模块
- [ ] 免责声明表（lt_disclaimer_agreement）
- [ ] 免责声明同意 API
- [ ] GPS 计时逻辑（起终点触发）
- [ ] WebSocket 实时推送（可选）

### 3.7 申诉模块
- [ ] 成绩申诉表（lt_record_appeal）
- [ ] 山路申诉表（lt_mountain_appeal）
- [ ] 申诉创建/查询 API

### 3.8 爬虫模块（P2 优先级）
- [ ] 爬虫日志表（lt_crawler_log）
- [ ] 爬取成绩表（lt_crawled_record）
- [ ] 51GT3 爬虫
- [ ] 键盘车神教爬虫
- [ ] 定时任务（每日凌晨5点）

---

## 第四阶段：测试与上线

### 4.1 测试
- [x] E2E 自动化测试文档
- [ ] 单元测试
- [ ] API 接口测试
- [ ] 前端功能测试
- [ ] 安全测试

### 4.2 部署上线
- [x] 生产环境 Docker 配置
- [x] Nginx 反向代理配置
- [ ] HTTPS 证书
- [ ] 域名配置
- [ ] 监控告警

---

## 开发顺序建议

```
阶段1: 基础架构 → 阶段2: 私域视频网站 → 阶段3: 圈速榜 → 阶段4: 测试上线
   ↓                    ↓                    ↓
 共用用户系统        功能相对简单          功能复杂
 技术栈搭建          先上线验证            逐步迭代
```

**理由**：
1. 私域视频网站功能更简单，可以快速上线验证技术栈
2. 用户系统共用，先完成后两个项目复用
3. 圈速榜功能多，建议分批次迭代

---

## 关键数字指标

### 私域视频网站
- 数据库表：~10张
- API接口：~20个
- 用户角色：4种（游客、注册用户、VIP、管理员）

### 圈速榜
- 数据库表：18张
- API接口：50+个
- 用户角色：5种（游客、注册用户、组织成员、组织管理员、系统管理员）
- 成绩来源：3类（官方、大V、个人）

---

## 开发进度总结

### 已完成 ✅
1. **基础架构**：Go + Vue 3 全栈项目搭建完成
2. **用户系统**：手机号登录、JWT 认证、角色管理
3. **内容管理**：分类、笔记、课程 CRUD
4. **课程系统**：课程列表、详情、文件管理（MD/ZIP）
5. **下载系统**：令牌生成、限制验证、文件下载
6. **管理后台**：课程管理、邀请码管理、文件上传
7. **部署配置**：Docker + Nginx 生产配置

### MVP 上线前必做 🔴
1. **短信验证码**：接入阿里云/腾讯云短信服务
2. **支付功能**：微信/支付宝支付集成

### 可选优化 🟡
- 会员公告滚动
- 游客 IP 排队限流
- 公告管理模块
