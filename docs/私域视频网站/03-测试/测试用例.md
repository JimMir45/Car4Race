# 测试用例

## 1. 测试概述

### 1.1 测试范围

| 模块 | 测试类型 | 说明 |
|-----|---------|------|
| 认证模块 | 功能测试 | 短信验证码、登录（含自动注册） |
| 用户模块 | 功能测试 | 个人信息、订单、历史记录 |
| 内容模块 | 功能测试 | 笔记、课程浏览 |
| 支付模块 | 功能测试 | 第三方支付、邀请码兑换 |
| 下载模块 | 功能测试 | 下载令牌、文件下载 |
| 安全模块 | 安全测试 | 频率限制、认证安全 |

> **MVP 版本说明**：会员模块和游客排队功能将在后续版本中实现。

### 1.2 测试环境

| 环境 | 配置 |
|-----|------|
| 操作系统 | Linux / macOS |
| 浏览器 | Chrome 100+, Firefox 100+, Safari 15+ |
| 数据库 | SQLite 3.x |
| Go 版本 | 1.21+ |
| Node 版本 | 18+ |

### 1.3 测试账号

| 角色 | 手机号 | 说明 |
|-----|-------|------|
| 普通用户 | 13800138001 | 未购买任何课程 |
| 付费用户 | 13800138002 | 已购买部分课程 |
| 站长 | 13800138000 | 管理员权限 |

### 1.4 错误码定义

| 错误码 | 说明 |
|-------|------|
| 0 | 成功 |
| 40001 | 参数错误/格式不正确 |
| 40003 | 下载链接已过期 |
| 40004 | 下载次数已用完 |
| 40005 | 未登录或登录已过期 |
| 40007 | 验证码错误或已过期 |
| 40009 | 邀请码无效或已被使用 |
| 40010 | 请求过于频繁 |
| 40301 | 无权限 |
| 40302 | 需要管理员权限 |
| 40303 | 未购买该课程 |
| 40304 | 已购买该课程 |
| 40401 | 资源不存在 |
| 40402 | 用户不存在 |
| 40403 | 课程不存在 |

---

## 2. 功能测试用例

### 2.1 认证模块

#### TC-AUTH-001：发送短信验证码 - 正常流程

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证正常发送短信验证码功能 |
| **前置条件** | 无 |
| **测试步骤** | 1. 打开登录页面<br>2. 输入有效手机号 13800138001<br>3. 点击"获取验证码"按钮 |
| **预期结果** | 1. 按钮显示 60 秒倒计时<br>2. 手机收到 6 位验证码<br>3. 接口返回 code=0 |
| **优先级** | P0 |

#### TC-AUTH-002：发送短信验证码 - 频率限制

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证 60 秒内不能重复发送验证码 |
| **前置条件** | 已发送过一次验证码 |
| **测试步骤** | 1. 发送验证码成功<br>2. 30 秒内再次请求发送 |
| **预期结果** | 1. 返回错误码 40010<br>2. 提示"请求过于频繁，请60秒后再试" |
| **优先级** | P0 |

#### TC-AUTH-003：发送短信验证码 - 无效手机号

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证无效手机号格式校验 |
| **前置条件** | 无 |
| **测试步骤** | 1. 输入无效手机号（如 123456）<br>2. 点击"获取验证码" |
| **预期结果** | 1. 返回错误码 40001<br>2. 提示"手机号格式不正确" |
| **优先级** | P0 |

#### TC-AUTH-004：用户登录 - 新用户自动注册

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证新用户首次登录自动注册功能 |
| **前置条件** | 手机号未注册 |
| **测试步骤** | 1. 输入手机号 13900139001<br>2. 获取并输入验证码<br>3. 点击"登录"按钮 |
| **预期结果** | 1. 登录成功，自动创建用户<br>2. 用户名格式为 YYYYMMDD + 手机后4位（如 202601179001）<br>3. 返回 JWT Token 和用户信息 |
| **优先级** | P0 |

#### TC-AUTH-005：用户登录 - 已注册用户

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证已注册用户登录功能 |
| **前置条件** | 手机号 13800138001 已注册 |
| **测试步骤** | 1. 输入手机号 13800138001<br>2. 获取并输入验证码<br>3. 点击"登录"按钮 |
| **预期结果** | 1. 登录成功<br>2. 返回用户信息和 Token<br>3. 跳转到首页或个人中心 |
| **优先级** | P0 |

#### TC-AUTH-006：用户登录 - 验证码错误

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证错误验证码校验 |
| **前置条件** | 无 |
| **测试步骤** | 1. 输入手机号<br>2. 输入错误的验证码 000000<br>3. 点击"登录"按钮 |
| **预期结果** | 1. 返回错误码 40007<br>2. 提示"验证码错误或已过期" |
| **优先级** | P0 |

#### TC-AUTH-007：用户登录 - 验证码过期

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证验证码 5 分钟有效期 |
| **前置条件** | 已获取验证码 |
| **测试步骤** | 1. 获取验证码<br>2. 等待 5 分钟以上<br>3. 使用该验证码登录 |
| **预期结果** | 1. 返回错误码 40007<br>2. 提示"验证码错误或已过期" |
| **优先级** | P1 |

---

### 2.2 用户模块

#### TC-USER-001：获取个人信息 - 正常流程

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证获取个人信息接口 |
| **前置条件** | 用户已登录 |
| **测试步骤** | 1. 携带有效 Token 访问个人中心<br>2. 调用 GET /api/v1/user/profile |
| **预期结果** | 1. 返回用户名、手机号<br>2. 返回昵称、头像等信息 |
| **优先级** | P0 |

#### TC-USER-002：获取个人信息 - Token 无效

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证无效 Token 拦截 |
| **前置条件** | 无 |
| **测试步骤** | 1. 使用无效 Token 请求个人信息 |
| **预期结果** | 1. 返回错误码 40005<br>2. 提示"未登录或登录已过期" |
| **优先级** | P0 |

#### TC-USER-003：获取我的订单 - 正常流程

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证订单列表展示 |
| **前置条件** | 用户已购买课程 |
| **测试步骤** | 1. 登录付费用户账号<br>2. 访问"我的订单"页面 |
| **预期结果** | 1. 显示所有订单记录<br>2. 包含订单号、课程信息、金额<br>3. 支付类型正确显示（支付/邀请码） |
| **优先级** | P0 |

#### TC-USER-004：获取我的订单 - 分页测试

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证订单列表分页功能 |
| **前置条件** | 用户有超过 10 条订单 |
| **测试步骤** | 1. 访问订单列表第 1 页<br>2. 访问订单列表第 2 页 |
| **预期结果** | 1. 每页显示指定条数记录<br>2. 分页信息正确<br>3. 数据不重复 |
| **优先级** | P1 |

#### TC-USER-005：获取浏览记录 - 正常流程

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证浏览记录功能 |
| **前置条件** | 用户已浏览笔记和课程 |
| **测试步骤** | 1. 浏览笔记 A<br>2. 浏览课程 B<br>3. 访问浏览记录页面 |
| **预期结果** | 1. 显示笔记 A 和课程 B 的浏览记录<br>2. 按时间倒序排列<br>3. 可按类型筛选 |
| **优先级** | P1 |

---

### 2.3 内容模块

#### TC-CONTENT-001：笔记列表 - 正常流程

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证笔记列表展示 |
| **前置条件** | 系统已有笔记数据 |
| **测试步骤** | 1. 访问笔记列表页面 |
| **预期结果** | 1. 显示笔记标题、摘要、分类<br>2. 显示浏览次数和发布时间<br>3. 游客可正常访问 |
| **优先级** | P0 |

#### TC-CONTENT-002：笔记列表 - 分类筛选

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证按分类筛选笔记 |
| **前置条件** | 存在多个分类的笔记 |
| **测试步骤** | 1. 选择分类"Go 语言"<br>2. 查看筛选结果 |
| **预期结果** | 1. 只显示 Go 语言分类的笔记<br>2. 分页正确 |
| **优先级** | P1 |

#### TC-CONTENT-003：笔记详情 - 正常流程

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证笔记详情展示 |
| **前置条件** | 笔记存在 |
| **测试步骤** | 1. 点击笔记标题进入详情页 |
| **预期结果** | 1. 显示完整 Markdown 内容<br>2. 正确渲染代码高亮<br>3. 浏览次数自动增加 |
| **优先级** | P0 |

#### TC-CONTENT-004：课程列表 - 默认排序

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证课程默认排序 |
| **前置条件** | 系统已有课程数据 |
| **测试步骤** | 1. 访问课程列表页面（不带排序参数） |
| **预期结果** | 1. 按最新排序（newest）<br>2. 显示课程封面、名称、价格 |
| **优先级** | P0 |

#### TC-CONTENT-005：课程列表 - 按价格排序

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证按价格排序 |
| **前置条件** | 课程有不同价格 |
| **测试步骤** | 1. 选择排序方式为 price_asc<br>2. 选择排序方式为 price_desc |
| **预期结果** | 1. 课程按价格正确排序<br>2. 显示价格数值 |
| **优先级** | P1 |

#### TC-CONTENT-006：课程列表 - 按销量排序

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证按销量排序 |
| **前置条件** | 课程有不同销量 |
| **测试步骤** | 1. 选择排序方式为 sales |
| **预期结果** | 1. 课程按销量降序排列<br>2. 显示销量数值 |
| **优先级** | P1 |

#### TC-CONTENT-007：课程详情 - 未购买状态

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证未购买课程的详情展示 |
| **前置条件** | 用户未购买该课程 |
| **测试步骤** | 1. 访问课程详情页 |
| **预期结果** | 1. 显示课程介绍和价格<br>2. purchased = false<br>3. 显示购买按钮 |
| **优先级** | P0 |

#### TC-CONTENT-008：课程详情 - 已购买状态

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证已购买课程的详情展示 |
| **前置条件** | 用户已购买该课程 |
| **测试步骤** | 1. 登录已购买该课程的账号<br>2. 访问课程详情页 |
| **预期结果** | 1. purchased = true<br>2. 显示下载按钮 |
| **优先级** | P0 |

---

### 2.4 支付模块

#### TC-PAY-001：第三方支付 - 创建订单

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证创建订单功能 |
| **前置条件** | 用户已登录，未购买目标课程 |
| **测试步骤** | 1. 进入课程详情页<br>2. 点击购买创建订单 |
| **预期结果** | 1. 创建订单成功<br>2. 返回订单信息 |
| **优先级** | P0 |

#### TC-PAY-002：邀请码兑换 - 正常流程

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证邀请码兑换课程 |
| **前置条件** | 用户已登录，持有有效邀请码 |
| **测试步骤** | 1. 进入课程详情页<br>2. 选择邀请码兑换<br>3. 输入有效邀请码 |
| **预期结果** | 1. 兑换成功<br>2. 创建订单（状态为 paid）<br>3. 邀请码使用次数增加<br>4. 课程销量增加 |
| **优先级** | P0 |

#### TC-PAY-003：邀请码兑换 - 无效邀请码

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证无效邀请码校验 |
| **前置条件** | 无 |
| **测试步骤** | 1. 输入不存在的邀请码 |
| **预期结果** | 1. 返回错误码 40009<br>2. 提示"邀请码无效或已被使用" |
| **优先级** | P0 |

#### TC-PAY-004：邀请码兑换 - 已用完邀请码

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证已用完邀请码不能继续使用 |
| **前置条件** | 邀请码使用次数已达上限 |
| **测试步骤** | 1. 输入已用完的邀请码 |
| **预期结果** | 1. 返回错误码 40009<br>2. 提示"邀请码已用完" |
| **优先级** | P0 |

#### TC-PAY-005：重复购买 - 已购买课程

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证重复购买课程的处理 |
| **前置条件** | 用户已购买该课程 |
| **测试步骤** | 1. 尝试再次购买同一课程 |
| **预期结果** | 1. 返回错误码 40304<br>2. 提示"您已购买该课程" |
| **优先级** | P1 |

---

### 2.5 下载模块

#### TC-DOWN-001：创建下载令牌 - 正常流程

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证创建下载令牌功能 |
| **前置条件** | 用户已购买课程，今日下载次数未用完 |
| **测试步骤** | 1. 访问下载页面<br>2. 请求创建下载令牌 |
| **预期结果** | 1. 返回下载令牌<br>2. 令牌 24 小时内有效<br>3. 返回下载 URL |
| **优先级** | P0 |

#### TC-DOWN-002：下载课程 - 正常流程

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证正常下载课程文件 |
| **前置条件** | 持有有效下载令牌 |
| **测试步骤** | 1. 使用下载令牌访问下载接口 |
| **预期结果** | 1. 返回课程视频信息<br>2. 令牌标记为已使用 |
| **优先级** | P0 |

#### TC-DOWN-003：下载课程 - 今日下载次数用完

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证每日下载次数限制（3次/天） |
| **前置条件** | 今日下载次数已用完（3次） |
| **测试步骤** | 1. 尝试创建新的下载令牌 |
| **预期结果** | 1. 返回错误码 40004<br>2. 提示"下载次数已用完，请联系客服" |
| **优先级** | P0 |

#### TC-DOWN-004：下载课程 - 下载链接过期

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证下载链接 24 小时有效期 |
| **前置条件** | 下载令牌已过期 |
| **测试步骤** | 1. 使用过期的下载令牌 |
| **预期结果** | 1. 返回错误码 40003<br>2. 提示"下载链接已过期" |
| **优先级** | P0 |

#### TC-DOWN-005：下载课程 - 未购买

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证未购买课程无法下载 |
| **前置条件** | 用户未购买该课程 |
| **测试步骤** | 1. 尝试创建下载令牌 |
| **预期结果** | 1. 返回错误码 40303<br>2. 提示"未购买该课程" |
| **优先级** | P0 |

---

### 2.6 站长管理模块

#### TC-ADMIN-001：创建邀请码 - 正常流程

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证站长创建邀请码功能 |
| **前置条件** | 使用站长账号登录 |
| **测试步骤** | 1. 访问邀请码管理<br>2. 选择课程<br>3. 设置最大使用次数<br>4. 点击生成 |
| **预期结果** | 1. 生成邀请码（格式 INV + 8位字符）<br>2. 状态为"未使用" |
| **优先级** | P0 |

#### TC-ADMIN-002：查看邀请码列表

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证邀请码列表展示 |
| **前置条件** | 存在邀请码数据 |
| **测试步骤** | 1. 访问邀请码列表 |
| **预期结果** | 1. 显示邀请码、关联课程<br>2. 显示使用次数/最大次数<br>3. 显示创建时间 |
| **优先级** | P1 |

#### TC-ADMIN-003：创建课程 - 正常流程

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证站长创建课程功能 |
| **前置条件** | 使用站长账号登录 |
| **测试步骤** | 1. 访问课程管理<br>2. 填写课程信息<br>3. 设置价格<br>4. 点击保存 |
| **预期结果** | 1. 课程创建成功<br>2. 前台可见新课程<br>3. 价格正确显示 |
| **优先级** | P0 |

#### TC-ADMIN-004：修改课程

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证站长修改课程 |
| **前置条件** | 课程已存在 |
| **测试步骤** | 1. 编辑课程<br>2. 修改信息<br>3. 保存 |
| **预期结果** | 1. 更新成功<br>2. 前台显示新信息 |
| **优先级** | P1 |

#### TC-ADMIN-005：权限验证 - 普通用户

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证普通用户无法访问管理接口 |
| **前置条件** | 使用普通用户账号登录 |
| **测试步骤** | 1. 尝试访问管理后台接口 |
| **预期结果** | 1. 返回错误码 40302<br>2. 提示"需要管理员权限" |
| **优先级** | P0 |

---

## 3. 安全测试用例

### 3.1 频率限制测试

#### TC-SEC-001：全局频率限制

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证 IP 级别请求频率限制 |
| **前置条件** | 无 |
| **测试步骤** | 1. 同一 IP 连续快速调用接口超过 100 次/分钟 |
| **预期结果** | 1. 超过限制后返回 40010<br>2. 提示"请求过于频繁，请稍后再试" |
| **优先级** | P0 |

#### TC-SEC-002：验证码频率限制

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证验证码 60 秒发送限制 |
| **前置条件** | 已发送验证码 |
| **测试步骤** | 1. 发送验证码成功<br>2. 60 秒内再次请求 |
| **预期结果** | 1. 返回错误码 40010<br>2. 提示"请求过于频繁，请60秒后再试" |
| **优先级** | P0 |

### 3.2 认证安全测试

#### TC-SEC-003：Token 过期验证

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证 Token 7 天有效期 |
| **前置条件** | Token 已过期 |
| **测试步骤** | 1. 使用过期 Token 访问接口 |
| **预期结果** | 1. 返回 40005<br>2. 提示"未登录或登录已过期" |
| **优先级** | P0 |

#### TC-SEC-004：Token 篡改检测

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证篡改 Token 被拒绝 |
| **前置条件** | 无 |
| **测试步骤** | 1. 修改 Token 中的 user_id<br>2. 使用修改后的 Token 访问接口 |
| **预期结果** | 1. Token 验证失败<br>2. 返回 40005 |
| **优先级** | P0 |

### 3.3 输入验证测试

#### TC-SEC-005：SQL 注入测试

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证防止 SQL 注入 |
| **前置条件** | 无 |
| **测试步骤** | 1. 在手机号输入 `' OR '1'='1`<br>2. 在 slug 参数输入 `'; DROP TABLE users; --` |
| **预期结果** | 1. 输入被正确转义<br>2. 不执行恶意 SQL<br>3. 返回参数错误 |
| **优先级** | P0 |

#### TC-SEC-006：XSS 攻击测试

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证防止 XSS 攻击 |
| **前置条件** | 无 |
| **测试步骤** | 1. 在可输入字段注入 `<script>alert('XSS')</script>` |
| **预期结果** | 1. 脚本被转义<br>2. 不执行 JavaScript |
| **优先级** | P0 |

---

## 4. 兼容性测试用例

### 4.1 浏览器兼容性

#### TC-COMP-001：Chrome 浏览器

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证 Chrome 浏览器兼容性 |
| **测试环境** | Chrome 100+ |
| **测试步骤** | 1. 访问所有页面<br>2. 执行所有核心功能 |
| **预期结果** | 1. 页面正常渲染<br>2. 功能正常运行 |
| **优先级** | P0 |

#### TC-COMP-002：Firefox 浏览器

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证 Firefox 浏览器兼容性 |
| **测试环境** | Firefox 100+ |
| **测试步骤** | 同 TC-COMP-001 |
| **预期结果** | 同 TC-COMP-001 |
| **优先级** | P1 |

#### TC-COMP-003：Safari 浏览器

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证 Safari 浏览器兼容性 |
| **测试环境** | Safari 15+ |
| **测试步骤** | 同 TC-COMP-001 |
| **预期结果** | 同 TC-COMP-001 |
| **优先级** | P1 |

### 4.2 响应式测试

#### TC-COMP-004：移动端适配

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证移动端页面适配 |
| **测试环境** | iPhone / Android 手机 |
| **测试步骤** | 1. 使用手机浏览器访问<br>2. 测试各页面布局 |
| **预期结果** | 1. 页面自适应屏幕<br>2. 按钮可正常点击<br>3. 文字可读 |
| **优先级** | P1 |

---

## 5. 性能测试用例

### 5.1 页面加载性能

#### TC-PERF-001：首页加载时间

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证首页加载时间 < 2s |
| **测试条件** | 网络正常，无缓存 |
| **测试步骤** | 1. 清除浏览器缓存<br>2. 访问首页<br>3. 记录加载时间 |
| **预期结果** | 1. 首次加载 < 3s<br>2. 缓存后加载 < 1s |
| **优先级** | P1 |

#### TC-PERF-002：笔记详情加载

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证笔记详情加载时间 |
| **测试条件** | 长篇 Markdown 笔记 |
| **测试步骤** | 1. 访问笔记详情页 |
| **预期结果** | 1. 内容加载 < 2s<br>2. Markdown 渲染流畅 |
| **优先级** | P1 |

### 5.2 接口响应性能

#### TC-PERF-003：API 响应时间

| 项目 | 内容 |
|-----|------|
| **测试目的** | 验证 API 响应时间 < 500ms |
| **测试条件** | 正常并发量 |
| **测试步骤** | 1. 调用各核心 API<br>2. 记录响应时间 |
| **预期结果** | 1. 平均响应时间 < 200ms<br>2. P99 响应时间 < 500ms |
| **优先级** | P1 |

---

## 6. 测试执行记录

### 6.1 测试轮次记录

| 轮次 | 日期 | 版本 | 执行人 | 通过率 | 备注 |
|-----|------|------|-------|--------|------|
| 第一轮 | - | v0.1.0 | - | - | 冒烟测试 |
| 第二轮 | - | v0.1.0 | - | - | 功能测试 |
| 第三轮 | - | v0.1.0 | - | - | 回归测试 |

### 6.2 缺陷统计

| 严重程度 | 数量 | 已修复 | 待修复 |
|---------|------|-------|--------|
| 致命 | 0 | 0 | 0 |
| 严重 | 0 | 0 | 0 |
| 一般 | 0 | 0 | 0 |
| 轻微 | 0 | 0 | 0 |

---

**文档版本**：v1.1
**创建日期**：2025-01-15
**最后更新**：2026-01-17
**更新说明**：
- 调整认证模块为合并登录/注册流程
- 移除会员模块（后续版本实现）
- 移除游客排队功能（后续版本实现）
- 更新下载限制为每日 3 次全局限制
- 下载令牌有效期调整为 24 小时
- 新增完整错误码定义表
